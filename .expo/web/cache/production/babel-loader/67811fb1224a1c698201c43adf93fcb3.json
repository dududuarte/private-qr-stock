{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _extends from\"@babel/runtime/helpers/extends\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{UnavailabilityError}from'@unimodules/core';import mapValues from'lodash/mapValues';import PropTypes from'prop-types';import React from'react';import findNodeHandle from\"react-native-web/dist/exports/findNodeHandle\";import Platform from\"react-native-web/dist/exports/Platform\";import ViewPropTypes from\"react-native-web/dist/exports/ViewPropTypes\";import ExponentCamera from\"./ExponentCamera\";import _CameraManager from\"./ExponentCameraManager\";var CameraManager=_CameraManager;var EventThrottleMs=500;var _PICTURE_SAVED_CALLBACKS={};var _GLOBAL_PICTURE_ID=1;function ensurePictureOptions(options){var pictureOptions=options||{};if(!pictureOptions||typeof pictureOptions!=='object'){pictureOptions={};}if(!pictureOptions.quality){pictureOptions.quality=1;}if(pictureOptions.onPictureSaved){var id=_GLOBAL_PICTURE_ID++;_PICTURE_SAVED_CALLBACKS[id]=pictureOptions.onPictureSaved;pictureOptions.id=id;pictureOptions.fastMode=true;}return pictureOptions;}function ensureRecordingOptions(options){var recordingOptions=options||{};if(!recordingOptions||typeof recordingOptions!=='object'){recordingOptions={};}else if(typeof recordingOptions.quality==='string'){recordingOptions.quality=Camera.Constants.VideoQuality[recordingOptions.quality];}return recordingOptions;}function ensureNativeProps(options){var props=options||{};if(!props||typeof props!=='object'){props={};}var newProps=mapValues(props,convertProp);var propsKeys=Object.keys(newProps);if(!propsKeys.includes('barCodeScannerSettings')&&propsKeys.includes('barCodeTypes')){console.warn(\"The \\\"barCodeTypes\\\" prop for Camera is deprecated and will be removed in SDK 34. Use \\\"barCodeScannerSettings\\\" instead.\");newProps.barCodeScannerSettings={barCodeTypes:newProps.barCodeTypes};}if(props.onBarCodeScanned){newProps.barCodeScannerEnabled=true;}if(props.onFacesDetected){newProps.faceDetectorEnabled=true;}if(Platform.OS!=='android'){delete newProps.ratio;delete newProps.useCamera2Api;}return newProps;}function convertProp(value,key){if(typeof value==='string'&&Camera.ConversionTables[key]){return Camera.ConversionTables[key][value];}return value;}function _onPictureSaved(_ref){var nativeEvent=_ref.nativeEvent;var id=nativeEvent.id,data=nativeEvent.data;var callback=_PICTURE_SAVED_CALLBACKS[id];if(callback){callback(data);delete _PICTURE_SAVED_CALLBACKS[id];}}var Camera=function(_React$Component){_inherits(Camera,_React$Component);function Camera(){var _this;_classCallCheck(this,Camera);_this=_possibleConstructorReturn(this,_getPrototypeOf(Camera).apply(this,arguments));_this._lastEvents={};_this._lastEventsTimes={};_this._onCameraReady=function(){if(_this.props.onCameraReady){_this.props.onCameraReady();}};_this._onMountError=function(_ref2){var nativeEvent=_ref2.nativeEvent;if(_this.props.onMountError){_this.props.onMountError(nativeEvent);}};_this._onObjectDetected=function(callback){return function(_ref3){var nativeEvent=_ref3.nativeEvent;var type=nativeEvent.type;if(_this._lastEvents[type]&&_this._lastEventsTimes[type]&&JSON.stringify(nativeEvent)===_this._lastEvents[type]&&new Date().getTime()-_this._lastEventsTimes[type].getTime()<EventThrottleMs){return;}if(callback){callback(nativeEvent);_this._lastEventsTimes[type]=new Date();_this._lastEvents[type]=JSON.stringify(nativeEvent);}};};_this._setReference=function(ref){if(ref){_this._cameraRef=ref;if(Platform.OS==='web'){_this._cameraHandle=ref;}else{_this._cameraHandle=findNodeHandle(ref);}}else{_this._cameraRef=null;_this._cameraHandle=null;}};return _this;}_createClass(Camera,[{key:\"takePictureAsync\",value:function takePictureAsync(options){var pictureOptions;return _regeneratorRuntime.async(function takePictureAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:pictureOptions=ensurePictureOptions(options);_context.next=3;return _regeneratorRuntime.awrap(CameraManager.takePicture(pictureOptions,this._cameraHandle));case 3:return _context.abrupt(\"return\",_context.sent);case 4:case\"end\":return _context.stop();}}},null,this);}},{key:\"getSupportedRatiosAsync\",value:function getSupportedRatiosAsync(){return _regeneratorRuntime.async(function getSupportedRatiosAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(CameraManager.getSupportedRatios){_context2.next=2;break;}throw new UnavailabilityError('Camera','getSupportedRatiosAsync');case 2:_context2.next=4;return _regeneratorRuntime.awrap(CameraManager.getSupportedRatios(this._cameraHandle));case 4:return _context2.abrupt(\"return\",_context2.sent);case 5:case\"end\":return _context2.stop();}}},null,this);}},{key:\"getAvailablePictureSizesAsync\",value:function getAvailablePictureSizesAsync(ratio){return _regeneratorRuntime.async(function getAvailablePictureSizesAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(CameraManager.getAvailablePictureSizes){_context3.next=2;break;}throw new UnavailabilityError('Camera','getAvailablePictureSizesAsync');case 2:_context3.next=4;return _regeneratorRuntime.awrap(CameraManager.getAvailablePictureSizes(ratio,this._cameraHandle));case 4:return _context3.abrupt(\"return\",_context3.sent);case 5:case\"end\":return _context3.stop();}}},null,this);}},{key:\"recordAsync\",value:function recordAsync(options){var recordingOptions;return _regeneratorRuntime.async(function recordAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(CameraManager.record){_context4.next=2;break;}throw new UnavailabilityError('Camera','recordAsync');case 2:recordingOptions=ensureRecordingOptions(options);_context4.next=5;return _regeneratorRuntime.awrap(CameraManager.record(recordingOptions,this._cameraHandle));case 5:return _context4.abrupt(\"return\",_context4.sent);case 6:case\"end\":return _context4.stop();}}},null,this);}},{key:\"stopRecording\",value:function stopRecording(){if(!CameraManager.stopRecording){throw new UnavailabilityError('Camera','stopRecording');}CameraManager.stopRecording(this._cameraHandle);}},{key:\"pausePreview\",value:function pausePreview(){if(!CameraManager.pausePreview){throw new UnavailabilityError('Camera','pausePreview');}CameraManager.pausePreview(this._cameraHandle);}},{key:\"resumePreview\",value:function resumePreview(){if(!CameraManager.resumePreview){throw new UnavailabilityError('Camera','resumePreview');}CameraManager.resumePreview(this._cameraHandle);}},{key:\"render\",value:function render(){var nativeProps=ensureNativeProps(this.props);var onBarCodeScanned=this._onObjectDetected(this.props.onBarCodeScanned);var onFacesDetected=this._onObjectDetected(this.props.onFacesDetected);return React.createElement(ExponentCamera,_extends({},nativeProps,{ref:this._setReference,onCameraReady:this._onCameraReady,onMountError:this._onMountError,onBarCodeScanned:onBarCodeScanned,onFacesDetected:onFacesDetected,onPictureSaved:_onPictureSaved}));}}],[{key:\"isAvailableAsync\",value:function isAvailableAsync(){return _regeneratorRuntime.async(function isAvailableAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(CameraManager.isAvailableAsync){_context5.next=2;break;}throw new UnavailabilityError('expo-camera','isAvailableAsync');case 2:_context5.next=4;return _regeneratorRuntime.awrap(CameraManager.isAvailableAsync());case 4:return _context5.abrupt(\"return\",_context5.sent);case 5:case\"end\":return _context5.stop();}}});}},{key:\"getAvailableCameraTypesAsync\",value:function getAvailableCameraTypesAsync(){return _regeneratorRuntime.async(function getAvailableCameraTypesAsync$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(CameraManager.getAvailableCameraTypesAsync){_context6.next=2;break;}throw new UnavailabilityError('expo-camera','getAvailableCameraTypesAsync');case 2:_context6.next=4;return _regeneratorRuntime.awrap(CameraManager.getAvailableCameraTypesAsync());case 4:return _context6.abrupt(\"return\",_context6.sent);case 5:case\"end\":return _context6.stop();}}});}},{key:\"getPermissionsAsync\",value:function getPermissionsAsync(){return _regeneratorRuntime.async(function getPermissionsAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt(\"return\",CameraManager.getPermissionsAsync());case 1:case\"end\":return _context7.stop();}}});}},{key:\"requestPermissionsAsync\",value:function requestPermissionsAsync(){return _regeneratorRuntime.async(function requestPermissionsAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt(\"return\",CameraManager.requestPermissionsAsync());case 1:case\"end\":return _context8.stop();}}});}}]);return Camera;}(React.Component);export{Camera as default};Camera.Constants={Type:CameraManager.Type,FlashMode:CameraManager.FlashMode,AutoFocus:CameraManager.AutoFocus,WhiteBalance:CameraManager.WhiteBalance,VideoQuality:CameraManager.VideoQuality,VideoStabilization:CameraManager.VideoStabilization||{}};Camera.ConversionTables={type:CameraManager.Type,flashMode:CameraManager.FlashMode,autoFocus:CameraManager.AutoFocus,whiteBalance:CameraManager.WhiteBalance};Camera.propTypes=_objectSpread({},ViewPropTypes,{zoom:PropTypes.number,ratio:PropTypes.string,focusDepth:PropTypes.number,onMountError:PropTypes.func,pictureSize:PropTypes.string,onCameraReady:PropTypes.func,useCamera2Api:PropTypes.bool,onBarCodeScanned:PropTypes.func,barCodeScannerSettings:PropTypes.object,onFacesDetected:PropTypes.func,faceDetectorSettings:PropTypes.object,type:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),flashMode:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),videoStabilizationMode:PropTypes.number,whiteBalance:PropTypes.oneOfType([PropTypes.string,PropTypes.number]),autoFocus:PropTypes.oneOfType([PropTypes.string,PropTypes.number,PropTypes.bool])});Camera.defaultProps={zoom:0,ratio:'4:3',focusDepth:0,faceDetectorSettings:{},type:CameraManager.Type.back,autoFocus:CameraManager.AutoFocus.on,flashMode:CameraManager.FlashMode.off,whiteBalance:CameraManager.WhiteBalance.auto};var Constants=Camera.Constants,getPermissionsAsync=Camera.getPermissionsAsync,requestPermissionsAsync=Camera.requestPermissionsAsync;export{Constants,getPermissionsAsync,requestPermissionsAsync};","map":{"version":3,"sources":["../src/Camera.tsx"],"names":[],"mappings":"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","sourcesContent":["import { UnavailabilityError } from '@unimodules/core';\nimport mapValues from 'lodash/mapValues';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { findNodeHandle, Platform, ViewPropTypes } from 'react-native';\nimport {\n  CapturedPicture,\n  NativeProps,\n  PictureOptions,\n  Props,\n  RecordingOptions,\n  PermissionResponse,\n} from './Camera.types';\nimport ExponentCamera from './ExponentCamera';\nimport _CameraManager from './ExponentCameraManager';\n\n// TODO: Bacon: Fix multiplatform\nconst CameraManager = _CameraManager as any;\n\nconst EventThrottleMs = 500;\n\nconst _PICTURE_SAVED_CALLBACKS = {};\n\nlet _GLOBAL_PICTURE_ID = 1;\n\nfunction ensurePictureOptions(options?: PictureOptions): PictureOptions {\n  let pictureOptions = options || {};\n\n  if (!pictureOptions || typeof pictureOptions !== 'object') {\n    pictureOptions = {};\n  }\n\n  if (!pictureOptions.quality) {\n    pictureOptions.quality = 1;\n  }\n  if (pictureOptions.onPictureSaved) {\n    const id = _GLOBAL_PICTURE_ID++;\n    _PICTURE_SAVED_CALLBACKS[id] = pictureOptions.onPictureSaved;\n    pictureOptions.id = id;\n    pictureOptions.fastMode = true;\n  }\n  return pictureOptions;\n}\n\nfunction ensureRecordingOptions(options?: RecordingOptions): RecordingOptions {\n  let recordingOptions = options || {};\n\n  if (!recordingOptions || typeof recordingOptions !== 'object') {\n    recordingOptions = {};\n  } else if (typeof recordingOptions.quality === 'string') {\n    recordingOptions.quality = Camera.Constants.VideoQuality[recordingOptions.quality];\n  }\n\n  return recordingOptions;\n}\n\nfunction ensureNativeProps(options?: Props): NativeProps {\n  let props = options || {};\n\n  if (!props || typeof props !== 'object') {\n    props = {};\n  }\n\n  const newProps: NativeProps = mapValues(props, convertProp);\n\n  const propsKeys = Object.keys(newProps);\n  // barCodeTypes is deprecated\n  if (!propsKeys.includes('barCodeScannerSettings') && propsKeys.includes('barCodeTypes')) {\n    console.warn(\n      `The \"barCodeTypes\" prop for Camera is deprecated and will be removed in SDK 34. Use \"barCodeScannerSettings\" instead.`\n    );\n    newProps.barCodeScannerSettings = {\n      // @ts-ignore\n      barCodeTypes: newProps.barCodeTypes,\n    };\n  }\n\n  if (props.onBarCodeScanned) {\n    newProps.barCodeScannerEnabled = true;\n  }\n\n  if (props.onFacesDetected) {\n    newProps.faceDetectorEnabled = true;\n  }\n\n  if (Platform.OS !== 'android') {\n    delete newProps.ratio;\n    delete newProps.useCamera2Api;\n  }\n\n  return newProps;\n}\n\nfunction convertProp(value: any, key: string): any {\n  if (typeof value === 'string' && Camera.ConversionTables[key]) {\n    return Camera.ConversionTables[key][value];\n  }\n\n  return value;\n}\n\nfunction _onPictureSaved({ nativeEvent }: { nativeEvent: { data: CapturedPicture; id: number } }) {\n  const { id, data } = nativeEvent;\n  const callback = _PICTURE_SAVED_CALLBACKS[id];\n  if (callback) {\n    callback(data);\n    delete _PICTURE_SAVED_CALLBACKS[id];\n  }\n}\n\nexport default class Camera extends React.Component<Props> {\n  static async isAvailableAsync(): Promise<boolean> {\n    if (!CameraManager.isAvailableAsync) {\n      throw new UnavailabilityError('expo-camera', 'isAvailableAsync');\n    }\n\n    return await CameraManager.isAvailableAsync();\n  }\n\n  static async getAvailableCameraTypesAsync(): Promise<('front' | 'back')[]> {\n    if (!CameraManager.getAvailableCameraTypesAsync) {\n      throw new UnavailabilityError('expo-camera', 'getAvailableCameraTypesAsync');\n    }\n\n    return await CameraManager.getAvailableCameraTypesAsync();\n  }\n\n  static Constants = {\n    Type: CameraManager.Type,\n    FlashMode: CameraManager.FlashMode,\n    AutoFocus: CameraManager.AutoFocus,\n    WhiteBalance: CameraManager.WhiteBalance,\n    VideoQuality: CameraManager.VideoQuality,\n    VideoStabilization: CameraManager.VideoStabilization || {},\n  };\n\n  // Values under keys from this object will be transformed to native options\n  static ConversionTables = {\n    type: CameraManager.Type,\n    flashMode: CameraManager.FlashMode,\n    autoFocus: CameraManager.AutoFocus,\n    whiteBalance: CameraManager.WhiteBalance,\n  };\n\n  static propTypes = {\n    ...ViewPropTypes,\n    zoom: PropTypes.number,\n    ratio: PropTypes.string,\n    focusDepth: PropTypes.number,\n    onMountError: PropTypes.func,\n    pictureSize: PropTypes.string,\n    onCameraReady: PropTypes.func,\n    useCamera2Api: PropTypes.bool,\n    onBarCodeScanned: PropTypes.func,\n    barCodeScannerSettings: PropTypes.object,\n    onFacesDetected: PropTypes.func,\n    faceDetectorSettings: PropTypes.object,\n    type: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    flashMode: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    videoStabilizationMode: PropTypes.number,\n    whiteBalance: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    autoFocus: PropTypes.oneOfType([PropTypes.string, PropTypes.number, PropTypes.bool]),\n  };\n\n  static defaultProps: Props = {\n    zoom: 0,\n    ratio: '4:3',\n    focusDepth: 0,\n    faceDetectorSettings: {},\n    type: CameraManager.Type.back,\n    autoFocus: CameraManager.AutoFocus.on,\n    flashMode: CameraManager.FlashMode.off,\n    whiteBalance: CameraManager.WhiteBalance.auto,\n  };\n\n  static async getPermissionsAsync(): Promise<PermissionResponse> {\n    return CameraManager.getPermissionsAsync();\n  }\n\n  static async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return CameraManager.requestPermissionsAsync();\n  }\n\n  _cameraHandle?: number | null;\n  _cameraRef?: React.Component | null;\n  _lastEvents: { [eventName: string]: string } = {};\n  _lastEventsTimes: { [eventName: string]: Date } = {};\n\n  async takePictureAsync(options?: PictureOptions): Promise<CapturedPicture> {\n    const pictureOptions = ensurePictureOptions(options);\n\n    return await CameraManager.takePicture(pictureOptions, this._cameraHandle);\n  }\n\n  async getSupportedRatiosAsync(): Promise<Array<string>> {\n    if (!CameraManager.getSupportedRatios) {\n      throw new UnavailabilityError('Camera', 'getSupportedRatiosAsync');\n    }\n\n    return await CameraManager.getSupportedRatios(this._cameraHandle);\n  }\n\n  async getAvailablePictureSizesAsync(ratio?: string): Promise<Array<string>> {\n    if (!CameraManager.getAvailablePictureSizes) {\n      throw new UnavailabilityError('Camera', 'getAvailablePictureSizesAsync');\n    }\n    return await CameraManager.getAvailablePictureSizes(ratio, this._cameraHandle);\n  }\n\n  async recordAsync(options?: RecordingOptions): Promise<{ uri: string }> {\n    if (!CameraManager.record) {\n      throw new UnavailabilityError('Camera', 'recordAsync');\n    }\n\n    const recordingOptions = ensureRecordingOptions(options);\n\n    return await CameraManager.record(recordingOptions, this._cameraHandle);\n  }\n\n  stopRecording() {\n    if (!CameraManager.stopRecording) {\n      throw new UnavailabilityError('Camera', 'stopRecording');\n    }\n\n    CameraManager.stopRecording(this._cameraHandle);\n  }\n\n  pausePreview() {\n    if (!CameraManager.pausePreview) {\n      throw new UnavailabilityError('Camera', 'pausePreview');\n    }\n\n    CameraManager.pausePreview(this._cameraHandle);\n  }\n\n  resumePreview() {\n    if (!CameraManager.resumePreview) {\n      throw new UnavailabilityError('Camera', 'resumePreview');\n    }\n\n    CameraManager.resumePreview(this._cameraHandle);\n  }\n\n  _onCameraReady = () => {\n    if (this.props.onCameraReady) {\n      this.props.onCameraReady();\n    }\n  };\n\n  _onMountError = ({ nativeEvent }: { nativeEvent: { message: string } }) => {\n    if (this.props.onMountError) {\n      this.props.onMountError(nativeEvent);\n    }\n  };\n\n  _onObjectDetected = (callback?: Function) => ({ nativeEvent }: { nativeEvent: any }) => {\n    const { type } = nativeEvent;\n    if (\n      this._lastEvents[type] &&\n      this._lastEventsTimes[type] &&\n      JSON.stringify(nativeEvent) === this._lastEvents[type] &&\n      new Date().getTime() - this._lastEventsTimes[type].getTime() < EventThrottleMs\n    ) {\n      return;\n    }\n\n    if (callback) {\n      callback(nativeEvent);\n      this._lastEventsTimes[type] = new Date();\n      this._lastEvents[type] = JSON.stringify(nativeEvent);\n    }\n  };\n\n  _setReference = (ref?: React.Component) => {\n    if (ref) {\n      this._cameraRef = ref;\n      // TODO: Bacon: Unify these\n      if (Platform.OS === 'web') {\n        this._cameraHandle = ref as any;\n      } else {\n        this._cameraHandle = findNodeHandle(ref);\n      }\n    } else {\n      this._cameraRef = null;\n      this._cameraHandle = null;\n    }\n  };\n\n  render() {\n    const nativeProps = ensureNativeProps(this.props);\n\n    const onBarCodeScanned = this._onObjectDetected(this.props.onBarCodeScanned);\n    const onFacesDetected = this._onObjectDetected(this.props.onFacesDetected);\n\n    return (\n      <ExponentCamera\n        {...nativeProps}\n        ref={this._setReference}\n        onCameraReady={this._onCameraReady}\n        onMountError={this._onMountError}\n        onBarCodeScanned={onBarCodeScanned}\n        onFacesDetected={onFacesDetected}\n        onPictureSaved={_onPictureSaved}\n      />\n    );\n  }\n}\n\nexport const { Constants, getPermissionsAsync, requestPermissionsAsync } = Camera;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}