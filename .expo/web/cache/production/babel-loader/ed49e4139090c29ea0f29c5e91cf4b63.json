{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{forwardRef}from'react';import createElement from\"react-native-web/dist/exports/createElement\";import findNodeHandle from\"react-native-web/dist/exports/findNodeHandle\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import CameraModule from\"./CameraModule/CameraModule\";import CameraManager from\"./ExponentCameraManager.web\";var ExponentCamera=function(_React$Component){_inherits(ExponentCamera,_React$Component);function ExponentCamera(){var _this;_classCallCheck(this,ExponentCamera);_this=_possibleConstructorReturn(this,_getPrototypeOf(ExponentCamera).apply(this,arguments));_this.state={type:null};_this._updateCameraProps=function _callee(_ref){var type,pictureSize,webCameraSettings,_assertThisInitialize,camera,actualCameraType;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:type=_ref.type,pictureSize=_ref.pictureSize,webCameraSettings=_objectWithoutProperties(_ref,[\"type\",\"pictureSize\"]);_assertThisInitialize=_assertThisInitialized(_this),camera=_assertThisInitialize.camera;if(camera){_context.next=4;break;}return _context.abrupt(\"return\");case 4:_context.next=6;return _regeneratorRuntime.awrap(camera.setTypeAsync(type));case 6:_context.next=8;return _regeneratorRuntime.awrap(camera.updateWebCameraSettingsAsync(webCameraSettings));case 8:_context.next=10;return _regeneratorRuntime.awrap(camera.ensureCameraIsRunningAsync());case 10:actualCameraType=camera.getActualCameraType();if(actualCameraType!==_this.state.type){_this.setState({type:actualCameraType});}case 12:case\"end\":return _context.stop();}}});};_this.getCamera=function(){if(_this.camera){return _this.camera;}throw new Error('Camera is not defined yet!');};_this.getAvailablePictureSizes=function _callee2(ratio){var camera;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:camera=_this.getCamera();return _context2.abrupt(\"return\",camera.getAvailablePictureSizes(ratio));case 2:case\"end\":return _context2.stop();}}});};_this.takePicture=function _callee3(options){var camera;return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:camera=_this.getCamera();return _context3.abrupt(\"return\",camera.takePicture(_objectSpread({},options,{onPictureSaved:_this.props.onPictureSaved})));case 2:case\"end\":return _context3.stop();}}});};_this.getAvailableCameraTypesAsync=function _callee4(){var camera;return _regeneratorRuntime.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:camera=_this.getCamera();_context4.next=3;return _regeneratorRuntime.awrap(camera.getAvailableCameraTypesAsync());case 3:return _context4.abrupt(\"return\",_context4.sent);case 4:case\"end\":return _context4.stop();}}});};_this.resumePreview=function _callee5(){var camera;return _regeneratorRuntime.async(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:camera=_this.getCamera();_context5.next=3;return _regeneratorRuntime.awrap(camera.resumePreview());case 3:case\"end\":return _context5.stop();}}});};_this.pausePreview=function _callee6(){var camera;return _regeneratorRuntime.async(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:camera=_this.getCamera();_context6.next=3;return _regeneratorRuntime.awrap(camera.stopAsync());case 3:case\"end\":return _context6.stop();}}});};_this.onCameraReady=function(){if(_this.props.onCameraReady){_this.props.onCameraReady();}};_this.onMountError=function(_ref2){var nativeEvent=_ref2.nativeEvent;if(_this.props.onMountError){_this.props.onMountError({nativeEvent:nativeEvent});}};_this._setRef=function(ref){if(!ref){_this.video=null;if(_this.camera){_this.camera.stopAsync();_this.camera=undefined;}return;}_this.video=findNodeHandle(ref);_this.video.webkitPlaysinline=true;_this.camera=new CameraModule(ref);_this.camera.onCameraReady=_this.onCameraReady;_this.camera.onMountError=_this.onMountError;_this._updateCameraProps(_this.props);};return _this;}_createClass(ExponentCamera,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.camera){this.camera.stopAsync();}}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){this._updateCameraProps(nextProps);}},{key:\"render\",value:function render(){var pointerEvents=this.props.pointerEvents;var isMuted=true;var isFrontFacingCamera=this.state.type===CameraManager.Type.front;var style={transform:isFrontFacingCamera?[{scaleX:-1}]:undefined};return React.createElement(View,{pointerEvents:\"box-none\",style:[styles.videoWrapper,this.props.style]},React.createElement(Video,{autoPlay:true,playsInline:true,muted:isMuted,pointerEvents:pointerEvents,ref:this._setRef,style:[StyleSheet.absoluteFill,styles.video,style]}),this.props.children);}}]);return ExponentCamera;}(React.Component);export{ExponentCamera as default};var Video=forwardRef(function(props,ref){return createElement('video',_objectSpread({},props,{ref:ref}));});var styles=StyleSheet.create({videoWrapper:{flex:1,alignItems:'stretch'},video:{width:'100%',height:'100%',objectFit:'cover'}});","map":{"version":3,"sources":["../src/ExponentCamera.web.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { forwardRef } from 'react';\nimport { createElement, findNodeHandle, StyleSheet, View } from 'react-native';\n\nimport { CapturedPicture, MountError, NativeProps, PictureOptions } from './Camera.types';\nimport CameraModule, { CameraType } from './CameraModule/CameraModule';\nimport CameraManager from './ExponentCameraManager.web';\n\nexport default class ExponentCamera extends React.Component<NativeProps> {\n  video?: number | null;\n  camera?: CameraModule;\n\n  state = { type: null };\n\n  componentWillUnmount() {\n    if (this.camera) {\n      this.camera.stopAsync();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this._updateCameraProps(nextProps);\n  }\n\n  _updateCameraProps = async ({ type, pictureSize, ...webCameraSettings }: NativeProps) => {\n    const { camera } = this;\n    if (!camera) {\n      return;\n    }\n\n    await camera.setTypeAsync(type as CameraType);\n\n    await camera.updateWebCameraSettingsAsync(webCameraSettings);\n\n    // await camera.setPictureSize(pictureSize as string);\n\n    await camera.ensureCameraIsRunningAsync();\n\n    const actualCameraType = camera.getActualCameraType();\n    if (actualCameraType !== this.state.type) {\n      this.setState({ type: actualCameraType });\n    }\n  };\n\n  getCamera = (): CameraModule => {\n    if (this.camera) {\n      return this.camera;\n    }\n    throw new Error('Camera is not defined yet!');\n  };\n\n  getAvailablePictureSizes = async (ratio: string): Promise<string[]> => {\n    const camera = this.getCamera();\n    return camera.getAvailablePictureSizes(ratio);\n  };\n\n  takePicture = async (options: PictureOptions): Promise<CapturedPicture> => {\n    const camera = this.getCamera();\n    return camera.takePicture({\n      ...options,\n      // This will always be defined, the option gets added to a queue in the upper-level. We should replace the original so it isn't called twice.\n      onPictureSaved: this.props.onPictureSaved,\n    });\n  };\n\n  getAvailableCameraTypesAsync = async (): Promise<string[]> => {\n    const camera = this.getCamera();\n    return await camera.getAvailableCameraTypesAsync();\n  };\n\n  resumePreview = async (): Promise<void> => {\n    const camera = this.getCamera();\n    await camera.resumePreview();\n  };\n\n  pausePreview = async (): Promise<void> => {\n    const camera = this.getCamera();\n    await camera.stopAsync();\n  };\n\n  onCameraReady = () => {\n    if (this.props.onCameraReady) {\n      this.props.onCameraReady();\n    }\n  };\n\n  onMountError = ({ nativeEvent }: { nativeEvent: MountError }) => {\n    if (this.props.onMountError) {\n      this.props.onMountError({ nativeEvent });\n    }\n  };\n\n  _setRef = ref => {\n    if (!ref) {\n      this.video = null;\n      if (this.camera) {\n        this.camera.stopAsync();\n        this.camera = undefined;\n      }\n      return;\n    }\n    this.video = findNodeHandle(ref);\n\n    (this.video as any).webkitPlaysinline = true;\n\n    this.camera = new CameraModule(ref);\n    this.camera.onCameraReady = this.onCameraReady;\n    this.camera.onMountError = this.onMountError;\n    this._updateCameraProps(this.props);\n  };\n\n  render() {\n    const { pointerEvents } = this.props;\n\n    // TODO: Bacon: Create a universal prop, on native the microphone is only used when recording videos.\n    // Because we don't support recording video in the browser we don't need the user to give microphone permissions.\n    const isMuted = true;\n\n    const isFrontFacingCamera = this.state.type === CameraManager.Type.front;\n    const style = {\n      // Flip the camera\n      transform: isFrontFacingCamera ? [{ scaleX: -1 }] : undefined,\n    };\n\n    return (\n      <View pointerEvents=\"box-none\" style={[styles.videoWrapper, this.props.style]}>\n        <Video\n          autoPlay\n          playsInline\n          muted={isMuted}\n          pointerEvents={pointerEvents}\n          ref={this._setRef}\n          style={[StyleSheet.absoluteFill, styles.video, style]}\n        />\n        {this.props.children}\n      </View>\n    );\n  }\n}\n\nconst Video: any = forwardRef((props, ref) => createElement('video', { ...props, ref }));\n\nconst styles = StyleSheet.create({\n  videoWrapper: {\n    flex: 1,\n    alignItems: 'stretch',\n  },\n  video: {\n    width: '100%',\n    height: '100%',\n    objectFit: 'cover',\n  },\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}